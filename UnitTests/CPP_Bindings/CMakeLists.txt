#########################################################
# Unittests on internal classes of the library

SET(TESTNAME "Test_CPP_Bindings")

set(SRCS_UNITTEST
	./Source/UnitTest_AllTests.cpp
	./Source/UnitTest_Attachments.cpp
	./Source/UnitTest_BaseMaterialGroup.cpp
	./Source/UnitTest_BeamLattice.cpp
	./Source/UnitTest_BeamSets.cpp
	./Source/UnitTest_BuildItems.cpp
	./Source/UnitTest_MeshObject.cpp
	./Source/UnitTest_MetaData.cpp
	./Source/UnitTest_MetaDataGroup.cpp
	./Source/UnitTest_Model.cpp
	./Source/UnitTest_Object.cpp
	./Source/UnitTest_ProgressCallback.cpp
	./Source/UnitTest_Reader.cpp
	./Source/UnitTest_SliceStack.cpp
	./Source/UnitTest_Writer.cpp
	./Source/UnitTest_Wrapper.cpp
)

set(CMAKE_CURRENT_BINARY_DIR ${CMAKE_BINARY_DIR})
SET_SOURCE_FILES_PROPERTIES(${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/CPP/lib3mf.cpp PROPERTIES GENERATED TRUE)
add_executable(${TESTNAME} ${SRCS_UNITTEST} ${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/CPP/lib3mf.cpp)

set(STARTUPPROJECT ${TESTNAME})

if (WIN32)
	target_compile_options(${TESTNAME} PUBLIC "$<$<CONFIG:DEBUG>:/Od;/Ob0;/Gm;/sdl;/W3;/WX;/FC;/MTd;/wd4996>")
	target_compile_options(${TESTNAME} PUBLIC "$<$<CONFIG:RELEASE>:/O2;/sdl;/WX;/Oi;/Gy;/FC;/MT;/wd4996>")
endif()

target_include_directories(${TESTNAME} PRIVATE
	${CMAKE_CURRENT_SOURCE_DIR}/Include
	${gtest_SOURCE_DIR}/include
	${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/CPP
	)
target_link_libraries(${TESTNAME} ${PROJECT_NAME}_s gtest gtest_main)
add_dependencies(${TESTNAME} ${PROJECT_NAME}_s)
set_target_properties(${TESTNAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/")

add_test(${TESTNAME} ${CMAKE_CURRENT_BINARY_DIR}/${TESTNAME})

if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "MSVC")
	IF(${CMAKE_VERSION} VERSION_LESS 3.6.3)
		MESSAGE ("Note: You need to manually select a StartUp-project in Visual Studio.")
	ELSE()
		set_property(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT ${STARTUPPROJECT})
	ENDIF()
endif()
